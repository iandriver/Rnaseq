#!/usr/bin/env python
#-*-python-*-

# The main rnaseq entry point
# fixme: right now it's just a testbed for development

import sys, os, yaml, optparse
from warn import *
from Rnaseq import *


########################################################################

def main():
    usage="usage: %s <cmd> [-p <pipeline>] [-r <readset_file>] [options]" % sys.argv[0] # fixme: form might be different; might be more like git
    argv=RnaseqGlobals.initialize(usage)       # not to be confused with sys.argv

    # get the command:
    try: cmd=argv[1]
    except IndexError as ie: cmd='help'
        
    cf=CmdFactory(program='rnaseq')
    cf.add_cmds(RnaseqGlobals.conf_value('rnaseq','cmds'))
    cmd=cf.new_cmd(cmd)

    # run the command 
    cmd.run(argv, config=RnaseqGlobals.config)
    print "rnaseq: done"

########################################################################

try:
    main()

except UserError as ue:
    die(ue)

except ProgrammerGoof as pg:
    warn("An internal error occured:\n")
    import traceback
    traceback.print_exc()
    sys.exit(1)

except ConfigError as ce:
    warn("A configuration error occured:\n")
    die(ce)

except RnaseqException as re:
    warn("An unexpected rnaseq exception has occured: %s\n" % re)
    if re.show_traceback:
        import traceback
        traceback.print_exc()
    die(re)

